<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Channel Home â€” Simple Player</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f7fa;color:#111}
  .wrap{max-width:900px;margin:18px auto;padding:12px}
  header{display:flex;gap:12px;align-items:center}
  h1{margin:0;font-size:20px}
  #player{width:100%;height:420px;border:0;background:#000}
  .tabs{margin:12px 0;display:flex;gap:8px}
  .tab{padding:8px 12px;background:#e6e9ef;border-radius:6px;cursor:pointer}
  .tab.active{background:#cfd6e6}
  #searchBox{display:none;margin:12px 0}
  #searchInput{width:calc(100% - 110px);padding:8px;font-size:15px}
  button{padding:8px 10px;font-size:14px;cursor:pointer}
  #results{margin-top:12px}
  .sectionTitle{margin:12px 0 6px;font-weight:700}
  .list{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
  .item{background:#fff;padding:8px;border-radius:6px;box-shadow:0 0 0 1px #e6e9ef; cursor:pointer;}
  .thumb{width:100%;height:140px;object-fit:cover;border-radius:4px;background:#ddd}
  .meta{padding-top:6px;font-size:14px}
  .loadMore{display:block;margin:14px auto;padding:8px 14px}
  .small{font-size:13px;color:#444}
  @media(max-width:520px){ #player{height:240px} .thumb{height:120px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1 id="chTitle">Channel</h1>
  </header>

  <!-- player -->
  <iframe id="player" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>

  <!-- tabs -->
  <div class="tabs">
    <div class="tab active" onclick="showTab('home')">Home</div>
    <div class="tab" onclick="showTab('videos')">Videos</div>
    <div class="tab" onclick="showTab('playlists')">Playlists</div>
    <div class="tab" onclick="showTab('search')">Search</div>
  </div>

  <!-- search input -->
  <div id="searchBox">
    <input id="searchInput" placeholder="Search inside channel..." />
    <button onclick="doSearch()">Search</button>
  </div>

  <!-- main results container -->
  <div id="results"></div>
</div>

<script>
/* ==== CONFIG - EDIT THESE 2 VALUES ==== */
const API_KEY = "AIzaSyAGjBiuitENeXolaDKLiqVAX47CGW1uqjw";        // <<< paste API key
const CHANNEL_ID = "UCrx-FlNM6BWOJvu3re6HH7w";  // <<< paste Channel ID
/* ===================================== */

const RESULTS = document.getElementById('results');
const PLAYER = document.getElementById('player');
const chTitle = document.getElementById('chTitle');
const searchBox = document.getElementById('searchBox');
const searchInput = document.getElementById('searchInput');

let tabs = { home:true, videos:false, playlists:false, search:false };
let tokens = { latest:null, popular:null, videos:null, playlists:null, search:null };

/* initial load */
(async function init(){
  await loadChannelInfo();
  showTab('home');
})();

/* show tab */
function showTab(name){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach((t,i)=>{ if(i===["home","videos","playlists","search"].indexOf(name)) t.classList.add('active') });
  searchBox.style.display = (name==='search') ? 'block' : 'none';
  RESULTS.innerHTML='';
  if(name==='home') loadHome();
  if(name==='videos') loadVideos();
  if(name==='playlists') loadPlaylists();
  if(name==='search') resultsMessage("Type minimum 2 chars and press Search");
}
function resultsMessage(msg){ RESULTS.innerHTML=`<p class="small">${msg}</p>`; }

/* load channel info */
async function loadChannelInfo(){
  try{
    const url=`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${CHANNEL_ID}&key=${API_KEY}`;
    const r=await fetch(url); const j=await r.json();
    if(!j.items || !j.items.length){ resultsMessage('Channel not found or API key invalid'); return; }
    const info=j.items[0].snippet;
    chTitle.textContent=info.title;
  }catch(e){ resultsMessage('Failed to load channel info.'); console.error(e);}
}

/* ---- HOME ---- */
async function loadHome(){
  RESULTS.innerHTML='';
  tokens.latest = tokens.popular = null;
  RESULTS.innerHTML += `<div class="sectionTitle">Latest uploads</div><div id="latestList" class="list"></div><button id="latestMore" class="loadMore" onclick="loadSection('latest')">Load more</button>`;
  RESULTS.innerHTML += `<div class="sectionTitle">Popular uploads</div><div id="popularList" class="list"></div><button id="popularMore" class="loadMore" onclick="loadSection('popular')">Load more</button>`;
  await loadSection('latest'); await loadSection('popular');
}
async function loadSection(section){
  const max=8;
  let params=`part=snippet&channelId=${CHANNEL_ID}&maxResults=${max}&key=${API_KEY}&type=video`;
  if(section==='latest') params += `&order=date`;
  if(section==='popular') params += `&order=viewCount`;
  if(tokens[section]) params += `&pageToken=${tokens[section]}`;
  let url=`https://www.googleapis.com/youtube/v3/search?${params}`;
  try{
    const r=await fetch(url); const j=await r.json();
    tokens[section]=j.nextPageToken || null;
    const listId = (section==='popular')?'popularList':'latestList';
    const list=document.getElementById(listId);
    j.items.forEach(it=>{ if(!it.id || !it.id.videoId) return; list.innerHTML += renderVideoItem(it); });
    const btnId=(section==='latest')?'latestMore':(section==='popular'?'popularMore':null);
    if(btnId && !tokens[section]) document.getElementById(btnId).style.display='none';
  }catch(e){ console.error(e); resultsMessage('Failed to load section'); }
}

/* render single video item */
function renderVideoItem(item){
  const vid=item.id.videoId;
  const thumb=item.snippet.thumbnails?.medium?.url||item.snippet.thumbnails?.default?.url||'';
  const title=item.snippet.title;
  const chId=item.snippet.channelId||CHANNEL_ID;
  return `<div class="item" onclick="attemptPlay('${vid}','${chId}')"><img class="thumb" src="${thumb}"><div class="meta"><b>${escapeHtml(title)}</b></div></div>`;
}
function attemptPlay(videoId,videoChannelId){
  if(videoChannelId!==CHANNEL_ID){ alert('Blocked: video is not from the allowed channel.'); return; }
  playVideo(videoId);
}
function playVideo(id,listId){ 
  PLAYER.src=`https://www.youtube.com/embed/${id}?autoplay=1${listId?`&list=${listId}`:''}&hl=ta&cc_load_policy=0`;
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ---- VIDEOS TAB ---- */
async function loadVideos(){
  RESULTS.innerHTML=`<div class="sectionTitle">All videos</div><div id="allVideos" class="list"></div><button id="videosMore" class="loadMore" onclick="loadMoreVideos()">Load more</button>`;
  tokens.videos=null; await loadMoreVideos();
}
async function loadMoreVideos(){
  const max=12;
  let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&maxResults=${max}&type=video&key=${API_KEY}`;
  if(tokens.videos) url += `&pageToken=${tokens.videos}`;
  const r=await fetch(url); const j=await r.json();
  tokens.videos=j.nextPageToken || null;
  const list=document.getElementById('allVideos');
  j.items.forEach(it=> list.innerHTML+=renderVideoItem(it));
  if(!tokens.videos) document.getElementById('videosMore').style.display='none';
}

/* ---- PLAYLISTS TAB ---- */
async function loadPlaylists(){
  RESULTS.innerHTML=`<div class="sectionTitle">Playlists</div><div id="pls" class="list"></div><button id="plsMore" class="loadMore" onclick="loadMorePlaylists()">Load more</button>`;
  tokens.playlists=null; await loadMorePlaylists();
}
async function loadMorePlaylists(){
  const max=12;
  let url=`https://www.googleapis.com/youtube/v3/playlists?part=snippet&channelId=${CHANNEL_ID}&maxResults=${max}&key=${API_KEY}`;
  if(tokens.playlists) url += `&pageToken=${tokens.playlists}`;
  const r=await fetch(url); const j=await r.json();
  tokens.playlists=j.nextPageToken||null;
  const list=document.getElementById('pls');
  j.items.forEach(pl=>{
    const id=pl.id; const title=pl.snippet.title; const thumb=pl.snippet.thumbnails?.medium?.url||'';
    list.innerHTML+=`<div class="item" onclick="loadPlaylist('${id}')"><img class="thumb" src="${thumb}"><div class="meta"><b>${escapeHtml(title)}</b></div></div>`;
  });
  if(!tokens.playlists) document.getElementById('plsMore').style.display='none';
}

/* load playlist videos (NEW: playlistId support for next/prev) */
async function loadPlaylist(plId){
  RESULTS.innerHTML=`<div class="sectionTitle">Playlist videos</div><div id="plVideos" class="list"></div>`;
  let pageToken=null; const max=12;
  async function page(){
    let url=`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${plId}&maxResults=${max}&key=${API_KEY}`;
    if(pageToken) url+=`&pageToken=${pageToken}`;
    const r=await fetch(url); const j=await r.json();
    pageToken=j.nextPageToken||null;
    const list=document.getElementById('plVideos');
    j.items.forEach(it=>{
      const vid=it.snippet.resourceId.videoId;
      const chId=it.snippet.channelId||CHANNEL_ID;
      const thumb=it.snippet.thumbnails?.medium?.url||'';
      const title=it.snippet.title;
      list.innerHTML+=`<div class="item" onclick="attemptPlayPlaylist('${vid}','${chId}','${plId}')"><img class="thumb" src="${thumb}"><div class="meta"><b>${escapeHtml(title)}</b></div></div>`;
    });
    if(pageToken) list.innerHTML+=`<button class="loadMore" id="plMoreBtn" onclick="page()">Load more</button>`;
    else { const b=document.getElementById('plMoreBtn'); if(b) b.style.display='none'; }
  }
  await page();
}
/* special attempt play for playlist videos */
function attemptPlayPlaylist(videoId, videoChannelId, playlistId){
  if(videoChannelId!==CHANNEL_ID){ alert('Blocked: video is not from the allowed channel.'); return; }
  playVideo(videoId,playlistId);
}

/* ---- SEARCH ---- */
async function doSearch(){
  const q=searchInput.value.trim(); if(q.length<2){ alert('Enter 2+ chars'); return; }
  tokens.search=null;
  RESULTS.innerHTML=`<div class="sectionTitle">Search results for "${escapeHtml(q)}"</div><div id="searchList" class="list"></div><button id="searchMore" class="loadMore" onclick="loadMoreSearch()">Load more</button>`;
  await loadMoreSearch();
}
async function loadMoreSearch(){
  const max=12;
  let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&q=${encodeURIComponent(searchInput.value)}&maxResults=${max}&type=video&key=${API_KEY}`;
  if(tokens.search) url+=`&pageToken=${tokens.search}`;
  const r=await fetch(url); const j=await r.json();
  tokens.search=j.nextPageToken||null;
  const list=document.getElementById('searchList');
  j.items.forEach(it=> list.innerHTML+=renderVideoItem(it));
  if(!tokens.search) document.getElementById('searchMore').style.display='none';
}

/* escape html helper */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }
</script>
</body>
</html>
